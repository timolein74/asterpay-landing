<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - AsterPay</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a24;
      --bg-card: #16161f;
      --border: #2a2a3a;
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --text-muted: #6a6a7a;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* Layout */
    .app {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 12px;
      margin-bottom: 32px;
      text-decoration: none;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: var(--gradient);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon svg {
      width: 22px;
      height: 22px;
    }

    .logo-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--accent);
      color: white;
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
      opacity: 0.8;
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      background: var(--bg-tertiary);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: var(--gradient);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .user-details {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-email {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Main Content */
    .main {
      flex: 1;
      margin-left: 260px;
      padding: 32px;
      max-width: 1200px;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-subtitle {
      color: var(--text-secondary);
      font-size: 15px;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
    }

    .stat-change {
      font-size: 13px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stat-change.positive {
      color: var(--success);
    }

    .stat-change.negative {
      color: var(--error);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    /* API Key Display */
    .api-key-display {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg-tertiary);
      padding: 16px;
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
    }

    .api-key-value {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .api-key-hidden {
      color: var(--text-muted);
    }

    /* Table */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      text-align: left;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      background: var(--bg-tertiary);
    }

    th:first-child {
      border-radius: 8px 0 0 8px;
    }

    th:last-child {
      border-radius: 0 8px 8px 0;
    }

    td {
      font-size: 14px;
      color: var(--text-secondary);
    }

    tr:hover td {
      background: var(--bg-tertiary);
    }

    /* Status Badge */
    .status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .status-paid {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .status-expired {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* Code Block */
    .code-block {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      overflow-x: auto;
      border: 1px solid var(--border);
    }

    .code-block .comment {
      color: var(--text-muted);
    }

    .code-block .keyword {
      color: #c678dd;
    }

    .code-block .string {
      color: #98c379;
    }

    .code-block .function {
      color: #61afef;
    }

    /* Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 12px;
    }

    .tab {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .tab.active {
      color: var(--accent);
      background: rgba(99, 102, 241, 0.1);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      width: 100%;
      max-width: 480px;
      transform: scale(0.95);
      transition: all 0.3s;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 8px;
    }

    /* Alert */
    .alert {
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .alert-warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--error);
    }

    /* Copy Button */
    .copy-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    .copy-btn.copied {
      color: var(--success);
    }

    /* Quick Start */
    .quick-start {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .quick-start-item {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-start-item:hover {
      border-color: var(--accent);
      background: rgba(99, 102, 241, 0.05);
    }

    .quick-start-icon {
      width: 40px;
      height: 40px;
      background: var(--gradient);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
    }

    .quick-start-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .quick-start-desc {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* Page Sections */
    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .quick-start {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        z-index: 1000;
        transition: left 0.3s ease;
        width: 280px;
      }
      
      .sidebar.open {
        left: 0;
      }
      
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 999;
      }
      
      .sidebar-overlay.open {
        display: block;
      }
      
      .mobile-header {
        display: flex !important;
      }
      
      .main {
        margin-left: 0;
        padding: 20px;
        padding-top: 80px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .page-title {
        font-size: 24px;
      }
      
      .section-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }
    }

    /* Mobile Header */
    .mobile-header {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 0 16px;
      align-items: center;
      justify-content: space-between;
      z-index: 998;
    }
    
    .mobile-header .logo {
      margin-bottom: 0;
      padding: 0;
    }
    
    .hamburger-btn {
      background: none;
      border: none;
      color: var(--text-primary);
      padding: 8px;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.2s;
    }
    
    .hamburger-btn:hover {
      background: var(--bg-tertiary);
    }
    
    .hamburger-btn svg {
      width: 24px;
      height: 24px;
    }
    
    .sidebar-close {
      display: none;
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: var(--text-secondary);
      padding: 8px;
      cursor: pointer;
      border-radius: 8px;
    }
    
    .sidebar-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    @media (max-width: 768px) {
      .sidebar-close {
        display: block;
      }
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Mobile Header -->
  <header class="mobile-header">
    <a href="/" class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="50,10 90,30 90,70 50,90 10,70 10,30" stroke="white" stroke-width="4" fill="none"/>
          <circle cx="50" cy="30" r="6" fill="white"/>
          <circle cx="75" cy="50" r="6" fill="white"/>
          <circle cx="50" cy="70" r="6" fill="white"/>
          <circle cx="25" cy="50" r="6" fill="white"/>
          <line x1="50" y1="30" x2="75" y2="50" stroke="white" stroke-width="2"/>
          <line x1="75" y1="50" x2="50" y2="70" stroke="white" stroke-width="2"/>
          <line x1="50" y1="70" x2="25" y2="50" stroke="white" stroke-width="2"/>
          <line x1="25" y1="50" x2="50" y2="30" stroke="white" stroke-width="2"/>
        </svg>
      </div>
      <span class="logo-text">AsterPay</span>
    </a>
    <button class="hamburger-btn" onclick="toggleSidebar()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
  </header>
  
  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <button class="sidebar-close" onclick="toggleSidebar()">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      <a href="/" class="logo">
        <div class="logo-icon">
          <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <polygon points="50,10 90,30 90,70 50,90 10,70 10,30" stroke="white" stroke-width="4" fill="none"/>
            <circle cx="50" cy="30" r="6" fill="white"/>
            <circle cx="75" cy="50" r="6" fill="white"/>
            <circle cx="50" cy="70" r="6" fill="white"/>
            <circle cx="25" cy="50" r="6" fill="white"/>
            <line x1="50" y1="30" x2="75" y2="50" stroke="white" stroke-width="2"/>
            <line x1="75" y1="50" x2="50" y2="70" stroke="white" stroke-width="2"/>
            <line x1="50" y1="70" x2="25" y2="50" stroke="white" stroke-width="2"/>
            <line x1="25" y1="50" x2="50" y2="30" stroke="white" stroke-width="2"/>
          </svg>
        </div>
        <span class="logo-text">AsterPay</span>
      </a>

      <nav class="nav-section">
        <div class="nav-label">Overview</div>
        <a class="nav-item active" data-page="overview">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          Dashboard
        </a>
        <a class="nav-item" data-page="payments">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
          Payments
        </a>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">Developers</div>
        <a class="nav-item" data-page="api-keys">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
          API Keys
        </a>
        <a class="nav-item" data-page="webhooks">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
          Webhooks
        </a>
        <a class="nav-item" href="https://api.asterpay.io/docs" target="_blank">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          API Docs
        </a>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">Account</div>
        <a class="nav-item" data-page="settings">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
          Settings
        </a>
        <a class="nav-item" id="logout-btn">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
          Logout
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">?</div>
          <div class="user-details">
            <div class="user-name" id="user-name">Loading...</div>
            <div class="user-email" id="user-email">...</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Overview Page -->
      <section class="page-section active" id="page-overview">
        <div class="page-header">
          <h1 class="page-title">Dashboard</h1>
          <p class="page-subtitle">Welcome back! Here's what's happening with your payments.</p>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-value" id="stat-revenue">$0.00</div>
            <div class="stat-change positive">
              <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>
              +0% from last month
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Payments</div>
            <div class="stat-value" id="stat-payments">0</div>
            <div class="stat-change positive">
              <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>
              +0% from last month
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Success Rate</div>
            <div class="stat-value" id="stat-success">0%</div>
            <div class="stat-change positive">+0%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending</div>
            <div class="stat-value" id="stat-pending">0</div>
            <div class="stat-change">Active payments</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Quick Start</h2>
          </div>
          <div class="quick-start">
            <div class="quick-start-item" onclick="showPage('api-keys')">
              <div class="quick-start-icon">
                <svg width="20" height="20" fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
              </div>
              <div class="quick-start-title">Get API Key</div>
              <div class="quick-start-desc">Copy your API key to start integrating</div>
            </div>
            <div class="quick-start-item" onclick="window.open('https://api.asterpay.io/docs', '_blank')">
              <div class="quick-start-icon">
                <svg width="20" height="20" fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              </div>
              <div class="quick-start-title">Read the Docs</div>
              <div class="quick-start-desc">Learn how to integrate AsterPay</div>
            </div>
            <div class="quick-start-item" onclick="showPage('webhooks')">
              <div class="quick-start-icon">
                <svg width="20" height="20" fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
              </div>
              <div class="quick-start-title">Setup Webhooks</div>
              <div class="quick-start-desc">Receive payment notifications</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Recent Payments</h2>
            <button class="btn btn-secondary btn-sm" onclick="showPage('payments')">View All</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Payment ID</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Created</th>
                </tr>
              </thead>
              <tbody id="recent-payments">
                <tr>
                  <td colspan="4" class="empty-state">
                    <p>No payments yet</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Payments Page -->
      <section class="page-section" id="page-payments">
        <div class="page-header">
          <h1 class="page-title">Payments</h1>
          <p class="page-subtitle">View and manage all your payment intents.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="tabs">
              <div class="tab active" data-filter="all">All</div>
              <div class="tab" data-filter="pending">Pending</div>
              <div class="tab" data-filter="paid">Paid</div>
              <div class="tab" data-filter="expired">Expired</div>
            </div>
            <button class="btn btn-primary btn-sm" onclick="createPaymentModal()">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
              New Payment
            </button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Payment ID</th>
                  <th>Amount</th>
                  <th>Chain</th>
                  <th>Wallet</th>
                  <th>Status</th>
                  <th>Created</th>
                </tr>
              </thead>
              <tbody id="payments-list">
                <tr>
                  <td colspan="6">
                    <div class="loading"><div class="spinner"></div></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- API Keys Page -->
      <section class="page-section" id="page-api-keys">
        <div class="page-header">
          <h1 class="page-title">API Keys</h1>
          <p class="page-subtitle">Manage your API keys for authentication.</p>
        </div>

        <div class="alert alert-warning">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
          <div>
            <strong>Keep your API keys secure!</strong><br>
            Never share your secret key or commit it to version control.
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Live API Key</h2>
          </div>
          <div class="api-key-display">
            <span class="api-key-value" id="api-key-display">sk_live_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
            <button class="copy-btn" onclick="copyApiKey()" title="Copy API Key">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
            </button>
            <button class="btn btn-secondary btn-sm" onclick="toggleApiKeyVisibility()">Show</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Quick Integration</h2>
          </div>
          <div class="code-block">
            <span class="comment">// Install the SDK</span><br>
            npm install @asterpay/sdk<br><br>
            <span class="comment">// Initialize with your API key</span><br>
            <span class="keyword">import</span> { AsterPay } <span class="keyword">from</span> <span class="string">'@asterpay/sdk'</span>;<br><br>
            <span class="keyword">const</span> aster = <span class="keyword">new</span> <span class="function">AsterPay</span>(<span class="string" id="code-api-key">'sk_live_...'</span>);<br><br>
            <span class="comment">// Create a payment</span><br>
            <span class="keyword">const</span> payment = <span class="keyword">await</span> aster.paymentIntents.<span class="function">create</span>({<br>
            &nbsp;&nbsp;amount: <span class="string">'10.00'</span>,<br>
            &nbsp;&nbsp;currency: <span class="string">'USDC'</span>,<br>
            &nbsp;&nbsp;chain: <span class="string">'base'</span><br>
            });
          </div>
        </div>
      </section>

      <!-- Webhooks Page -->
      <section class="page-section" id="page-webhooks">
        <div class="page-header">
          <h1 class="page-title">Webhooks</h1>
          <p class="page-subtitle">Configure webhook endpoints to receive payment events.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Webhook Configuration</h2>
          </div>
          <form id="webhook-form">
            <div class="form-group">
              <label class="form-label">Webhook URL</label>
              <input type="url" class="form-input" id="webhook-url" placeholder="https://your-app.com/webhooks/asterpay">
            </div>
            <button type="submit" class="btn btn-primary">Save Webhook URL</button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Webhook Secret</h2>
          </div>
          <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
            Use this secret to verify webhook signatures in your application.
          </p>
          <div class="api-key-display">
            <span class="api-key-value" id="webhook-secret-display">whsec_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
            <button class="copy-btn" onclick="copyWebhookSecret()" title="Copy Secret">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Event Types</h2>
          </div>
          <table>
            <thead>
              <tr>
                <th>Event</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code style="color: var(--accent);">payment.created</code></td>
                <td>A new payment intent was created</td>
              </tr>
              <tr>
                <td><code style="color: var(--accent);">payment.paid</code></td>
                <td>Payment was successfully received and confirmed</td>
              </tr>
              <tr>
                <td><code style="color: var(--accent);">payment.expired</code></td>
                <td>Payment intent expired without receiving funds</td>
              </tr>
              <tr>
                <td><code style="color: var(--accent);">payment.cancelled</code></td>
                <td>Payment intent was cancelled</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Settings Page -->
      <section class="page-section" id="page-settings">
        <div class="page-header">
          <h1 class="page-title">Settings</h1>
          <p class="page-subtitle">Manage your account settings and payout configuration.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ðŸ’° Payout Configuration</h2>
          </div>
          <div class="alert alert-warning" style="margin-bottom: 20px;">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            <div>
              <strong>Important!</strong> Set your payout wallet to receive funds automatically. Without a payout wallet, payments will be held until you configure one.
            </div>
          </div>
          <form id="payout-form">
            <div class="form-group">
              <label class="form-label">Payout Wallet Address</label>
              <input type="text" class="form-input" id="payout-wallet" placeholder="0x..." style="font-family: 'JetBrains Mono', monospace;">
              <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">Your Ethereum wallet address where you'll receive payouts (works on all chains)</p>
            </div>
            <button type="submit" class="btn btn-primary">Save Payout Wallet</button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ðŸ“Š Your Fee Tier</h2>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px;">
              <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Monthly Volume</div>
              <div style="font-size: 24px; font-weight: 700;" id="fee-monthly-volume">$0.00</div>
            </div>
            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px;">
              <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Current Fee Rate</div>
              <div style="font-size: 24px; font-weight: 700; color: var(--success);" id="fee-current-rate">0%</div>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>Volume Tier</th>
                <th>Fee</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="fee-tiers-table">
              <tr><td>$0 - $1,000/month</td><td>0%</td><td><span class="status status-paid">FREE</span></td></tr>
              <tr><td>$1,000 - $10,000/month</td><td>1%</td><td></td></tr>
              <tr><td>$10,000 - $100,000/month</td><td>0.5%</td><td></td></tr>
              <tr><td>$100,000+/month</td><td>0.3%</td><td></td></tr>
            </tbody>
          </table>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Account Information</h2>
          </div>
          <form id="settings-form">
            <div class="form-group">
              <label class="form-label">Name</label>
              <input type="text" class="form-input" id="settings-name" placeholder="Your name">
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="settings-email" placeholder="your@email.com" disabled>
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </form>
        </div>
      </section>
    </main>
  </div>

  <!-- Create Payment Modal -->
  <div class="modal-overlay" id="create-payment-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Create Payment</h2>
      </div>
      <form id="create-payment-form">
        <div class="form-group">
          <label class="form-label">Amount (USDC)</label>
          <input type="number" class="form-input" id="payment-amount" placeholder="10.00" step="0.01" min="0.01" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description (optional)</label>
          <input type="text" class="form-input" id="payment-description" placeholder="Order #123, Subscription, etc.">
        </div>
        <div class="form-group">
          <label class="form-label">Network</label>
          <select class="form-input" id="payment-chain" required>
            <option value="base">Base (Recommended - Low fees)</option>
            <option value="ethereum">Ethereum</option>
            <option value="polygon">Polygon</option>
            <option value="arbitrum">Arbitrum</option>
          </select>
        </div>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" style="flex: 1;" id="create-btn">Create Payment</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Payment Created Success Modal -->
  <div class="modal-overlay" id="payment-success-modal">
    <div class="modal" style="max-width: 520px;">
      <div class="modal-header" style="text-align: center;">
        <div style="width: 60px; height: 60px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
          <svg width="32" height="32" fill="none" stroke="var(--success)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
        </div>
        <h2 class="modal-title">Payment Created!</h2>
        <p style="color: var(--text-secondary); margin-top: 8px;">Share this payment link or QR code with your customer</p>
      </div>
      
      <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin: 24px 0; text-align: center;">
        <div style="font-size: 32px; font-weight: 700; color: var(--success); margin-bottom: 8px;" id="success-amount">$10.00</div>
        <div style="font-size: 14px; color: var(--text-muted);" id="success-chain">USDC on Base</div>
      </div>

      <!-- QR Code -->
      <div style="text-align: center; margin-bottom: 24px;">
        <div id="qr-code" style="background: white; padding: 16px; border-radius: 12px; display: inline-block;"></div>
        <p style="font-size: 12px; color: var(--text-muted); margin-top: 12px;">Scan to pay with any crypto wallet</p>
      </div>

      <!-- Wallet Address -->
      <div class="form-group">
        <label class="form-label">Payment Address</label>
        <div class="api-key-display" style="background: var(--bg-primary);">
          <span class="api-key-value" id="success-wallet" style="font-size: 12px;">0x...</span>
          <button class="copy-btn" onclick="copyWalletAddress()" title="Copy Address" id="copy-wallet-btn">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          </button>
        </div>
      </div>

      <!-- Status -->
      <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 8px; padding: 12px 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
        <div class="spinner" style="width: 20px; height: 20px; border-width: 2px; border-top-color: var(--warning);"></div>
        <div>
          <div style="font-weight: 500; color: var(--warning);">Waiting for payment...</div>
          <div style="font-size: 12px; color: var(--text-muted);" id="success-expires">Expires in 30 minutes</div>
        </div>
      </div>

      <div style="display: flex; gap: 12px;">
        <button class="btn btn-secondary" style="flex: 1;" onclick="closeSuccessModal()">Close</button>
        <button class="btn btn-primary" style="flex: 1;" onclick="copyPaymentLink()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
          Share Link
        </button>
      </div>
    </div>
  </div>

  <!-- QR Code Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  
  <script>
    const API_BASE = 'https://api.asterpay.io';
    let currentUser = null;
    let apiKey = null;
    let apiKeyVisible = false;
    let currentPayment = null;

    // Check authentication on load
    document.addEventListener('DOMContentLoaded', () => {
      const storedUser = localStorage.getItem('asterpay_user');
      const storedApiKey = localStorage.getItem('asterpay_api_key');
      
      if (!storedUser || !storedApiKey) {
        window.location.href = 'login.html';
        return;
      }
      
      currentUser = JSON.parse(storedUser);
      apiKey = storedApiKey;
      
      initDashboard();
    });

    function initDashboard() {
      // Update user info
      document.getElementById('user-name').textContent = currentUser.name || 'User';
      document.getElementById('user-email').textContent = currentUser.email;
      document.getElementById('user-avatar').textContent = (currentUser.name || currentUser.email)[0].toUpperCase();
      
      // Update settings form
      document.getElementById('settings-name').value = currentUser.name || '';
      document.getElementById('settings-email').value = currentUser.email;
      
      // Setup navigation
      document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.addEventListener('click', () => {
          showPage(item.dataset.page);
          // Close sidebar on mobile
          if (window.innerWidth <= 768) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
            document.body.style.overflow = '';
          }
        });
      });
      
      // Setup logout
      document.getElementById('logout-btn').addEventListener('click', logout);
      
      // Setup forms
      document.getElementById('webhook-form').addEventListener('submit', saveWebhook);
      document.getElementById('create-payment-form').addEventListener('submit', createPayment);
      document.getElementById('settings-form').addEventListener('submit', saveSettings);
      document.getElementById('payout-form').addEventListener('submit', savePayoutWallet);
      
      // Setup tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          loadPayments(tab.dataset.filter);
        });
      });
      
      // Load initial data
      loadDashboardData();
    }

    function showPage(page) {
      document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      document.getElementById(`page-${page}`).classList.add('active');
      document.querySelector(`.nav-item[data-page="${page}"]`)?.classList.add('active');
      
      if (page === 'payments') {
        loadPayments('all');
      } else if (page === 'settings') {
        loadFeeInfo();
        loadPayoutWallet();
      }
    }

    async function loadDashboardData() {
      try {
        const response = await fetch(`${API_BASE}/v1/payment_intents`, {
          headers: { 'Authorization': `Bearer ${apiKey}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          const payments = data.data || [];
          
          // Calculate stats
          const paid = payments.filter(p => p.status === 'paid');
          const pending = payments.filter(p => p.status === 'pending');
          const totalRevenue = paid.reduce((sum, p) => sum + parseFloat(p.amount), 0);
          const successRate = payments.length > 0 ? (paid.length / payments.length * 100).toFixed(1) : 0;
          
          // Update stats
          document.getElementById('stat-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
          document.getElementById('stat-payments').textContent = payments.length;
          document.getElementById('stat-success').textContent = `${successRate}%`;
          document.getElementById('stat-pending').textContent = pending.length;
          
          // Update recent payments
          const recentTable = document.getElementById('recent-payments');
          if (payments.length > 0) {
            recentTable.innerHTML = payments.slice(0, 5).map(p => `
              <tr>
                <td style="font-family: 'JetBrains Mono', monospace; font-size: 13px;">${p.id}</td>
                <td>${parseFloat(p.amount).toFixed(2)} ${p.currency}</td>
                <td><span class="status status-${p.status}"><span class="status-dot"></span>${p.status}</span></td>
                <td>${new Date(p.created_at).toLocaleDateString()}</td>
              </tr>
            `).join('');
          }
        }
      } catch (error) {
        console.error('Failed to load dashboard data:', error);
      }
    }

    async function loadPayments(filter = 'all') {
      const tbody = document.getElementById('payments-list');
      tbody.innerHTML = '<tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr>';
      
      try {
        let url = `${API_BASE}/v1/payment_intents`;
        if (filter !== 'all') {
          url += `?status=${filter}`;
        }
        
        const response = await fetch(url, {
          headers: { 'Authorization': `Bearer ${apiKey}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          const payments = data.data || [];
          
          if (payments.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="6" class="empty-state">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                  <h3>No payments found</h3>
                  <p>Create your first payment to get started</p>
                </td>
              </tr>
            `;
          } else {
            tbody.innerHTML = payments.map(p => `
              <tr>
                <td style="font-family: 'JetBrains Mono', monospace; font-size: 13px;">${p.id}</td>
                <td>${parseFloat(p.amount).toFixed(2)} ${p.currency}</td>
                <td>${p.chain}</td>
                <td style="font-family: 'JetBrains Mono', monospace; font-size: 12px;">${p.wallet_address.slice(0, 8)}...${p.wallet_address.slice(-6)}</td>
                <td><span class="status status-${p.status}"><span class="status-dot"></span>${p.status}</span></td>
                <td>${new Date(p.created_at).toLocaleString()}</td>
              </tr>
            `).join('');
          }
        }
      } catch (error) {
        console.error('Failed to load payments:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><p>Failed to load payments</p></td></tr>';
      }
    }

    function createPaymentModal() {
      document.getElementById('create-payment-modal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('create-payment-modal').classList.remove('active');
    }

    async function createPayment(e) {
      e.preventDefault();
      
      const amount = document.getElementById('payment-amount').value;
      const chain = document.getElementById('payment-chain').value;
      const description = document.getElementById('payment-description').value;
      const createBtn = document.getElementById('create-btn');
      
      createBtn.disabled = true;
      createBtn.innerHTML = '<div class="spinner" style="width: 16px; height: 16px; border-width: 2px;"></div> Creating...';
      
      try {
        const response = await fetch(`${API_BASE}/v1/payment_intents`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            amount: amount,
            currency: 'USDC',
            chain: chain,
            description: description || undefined
          })
        });
        
        if (response.ok) {
          const payment = await response.json();
          currentPayment = payment;
          
          // Close create modal
          closeModal();
          document.getElementById('create-payment-form').reset();
          
          // Show success modal
          showPaymentSuccess(payment);
          
          // Refresh data
          loadPayments('all');
          loadDashboardData();
        } else {
          const errorText = await response.text();
          console.error('API Error:', response.status, errorText);
          let errorMsg = 'Unknown error';
          try {
            const error = JSON.parse(errorText);
            errorMsg = error.message || error.error || JSON.stringify(error);
          } catch {
            errorMsg = errorText || `HTTP ${response.status}`;
          }
          alert('Failed to create payment: ' + errorMsg);
        }
      } catch (error) {
        console.error('Failed to create payment:', error);
        alert('Failed to create payment: ' + (error.message || 'Network error - check console'));
      } finally {
        createBtn.disabled = false;
        createBtn.innerHTML = 'Create Payment';
      }
    }

    function showPaymentSuccess(payment) {
      // Update modal content
      document.getElementById('success-amount').textContent = `$${parseFloat(payment.amount).toFixed(2)}`;
      document.getElementById('success-chain').textContent = `USDC on ${payment.chain.charAt(0).toUpperCase() + payment.chain.slice(1)}`;
      document.getElementById('success-wallet').textContent = payment.wallet_address;
      
      // Calculate expiry
      const expiresAt = new Date(payment.expires_at);
      const now = new Date();
      const minutesLeft = Math.max(0, Math.round((expiresAt - now) / 60000));
      document.getElementById('success-expires').textContent = `Expires in ${minutesLeft} minutes`;
      
      // Generate QR code
      const qrContainer = document.getElementById('qr-code');
      qrContainer.innerHTML = '';
      
      // Create QR code with wallet address
      try {
        new QRCode(qrContainer, {
          text: payment.wallet_address,
          width: 180,
          height: 180,
          colorDark: '#000000',
          colorLight: '#ffffff',
          correctLevel: QRCode.CorrectLevel.M
        });
      } catch (qrError) {
        console.error('QR code generation failed:', qrError);
        qrContainer.innerHTML = '<p style="color: var(--text-muted);">QR code unavailable</p>';
      }
      
      // Show modal
      document.getElementById('payment-success-modal').classList.add('active');
      
      // Start polling for payment status
      startPaymentStatusPolling(payment.id);
    }

    function getChainId(chain) {
      const chainIds = {
        'ethereum': 1,
        'base': 8453,
        'polygon': 137,
        'arbitrum': 42161
      };
      return chainIds[chain] || 1;
    }

    let statusPollingInterval = null;

    function startPaymentStatusPolling(paymentId) {
      // Clear any existing polling
      if (statusPollingInterval) {
        clearInterval(statusPollingInterval);
      }
      
      statusPollingInterval = setInterval(async () => {
        try {
          const response = await fetch(`${API_BASE}/v1/payment_intents/${paymentId}`, {
            headers: { 'Authorization': `Bearer ${apiKey}` }
          });
          
          if (response.ok) {
            const payment = await response.json();
            
            if (payment.status === 'paid') {
              clearInterval(statusPollingInterval);
              showPaymentComplete();
            } else if (payment.status === 'expired') {
              clearInterval(statusPollingInterval);
              showPaymentExpired();
            }
          }
        } catch (error) {
          console.error('Status poll error:', error);
        }
      }, 5000); // Poll every 5 seconds
    }

    function showPaymentComplete() {
      const statusDiv = document.querySelector('#payment-success-modal .alert-warning') || 
                        document.querySelector('#payment-success-modal [style*="rgba(245, 158, 11"]');
      if (statusDiv) {
        statusDiv.style.background = 'rgba(16, 185, 129, 0.1)';
        statusDiv.style.borderColor = 'rgba(16, 185, 129, 0.2)';
        statusDiv.innerHTML = `
          <svg width="24" height="24" fill="none" stroke="var(--success)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
          <div>
            <div style="font-weight: 500; color: var(--success);">Payment Received! âœ“</div>
            <div style="font-size: 12px; color: var(--text-muted);">Funds will be sent to your payout wallet</div>
          </div>
        `;
      }
      loadDashboardData();
      loadPayments('all');
    }

    function showPaymentExpired() {
      const statusDiv = document.querySelector('#payment-success-modal [style*="rgba(245, 158, 11"]');
      if (statusDiv) {
        statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
        statusDiv.style.borderColor = 'rgba(239, 68, 68, 0.2)';
        statusDiv.innerHTML = `
          <svg width="24" height="24" fill="none" stroke="var(--error)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          <div>
            <div style="font-weight: 500; color: var(--error);">Payment Expired</div>
            <div style="font-size: 12px; color: var(--text-muted);">Create a new payment to try again</div>
          </div>
        `;
      }
    }

    function closeSuccessModal() {
      document.getElementById('payment-success-modal').classList.remove('active');
      if (statusPollingInterval) {
        clearInterval(statusPollingInterval);
      }
    }

    function copyWalletAddress() {
      if (currentPayment) {
        navigator.clipboard.writeText(currentPayment.wallet_address);
        const btn = document.getElementById('copy-wallet-btn');
        btn.innerHTML = '<svg width="20" height="20" fill="none" stroke="var(--success)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
        setTimeout(() => {
          btn.innerHTML = '<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>';
        }, 2000);
      }
    }

    function copyPaymentLink() {
      if (currentPayment) {
        const link = `${window.location.origin}/pay/${currentPayment.id}`;
        navigator.clipboard.writeText(currentPayment.wallet_address);
        alert('Wallet address copied! Share this with your customer to receive payment.');
      }
    }

    async function saveWebhook(e) {
      e.preventDefault();
      const url = document.getElementById('webhook-url').value;
      
      try {
        const response = await fetch(`${API_BASE}/v1/webhooks/config`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ url })
        });
        
        if (response.ok) {
          alert('Webhook URL saved successfully!');
        } else {
          alert('Failed to save webhook URL');
        }
      } catch (error) {
        console.error('Failed to save webhook:', error);
        alert('Failed to save webhook URL');
      }
    }

    async function saveSettings(e) {
      e.preventDefault();
      const name = document.getElementById('settings-name').value;
      
      try {
        const response = await fetch(`${API_BASE}/v1/customers/me`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name })
        });
        
        if (response.ok) {
          const data = await response.json();
          currentUser.name = data.name;
          localStorage.setItem('asterpay_user', JSON.stringify(currentUser));
          document.getElementById('user-name').textContent = data.name || 'User';
          alert('Settings saved successfully!');
        } else {
          alert('Failed to save settings');
        }
      } catch (error) {
        console.error('Failed to save settings:', error);
        alert('Failed to save settings');
      }
    }

    async function savePayoutWallet(e) {
      e.preventDefault();
      const payoutWallet = document.getElementById('payout-wallet').value;
      
      if (!payoutWallet.match(/^0x[a-fA-F0-9]{40}$/)) {
        alert('Invalid wallet address. Must be a valid Ethereum address (0x...)');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/v1/customers/me`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ payoutWallet })
        });
        
        if (response.ok) {
          alert('Payout wallet saved successfully! You will now receive automatic payouts to this address.');
        } else {
          const error = await response.json();
          alert('Failed to save payout wallet: ' + (error.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('Failed to save payout wallet:', error);
        alert('Failed to save payout wallet');
      }
    }

    async function loadFeeInfo() {
      try {
        const response = await fetch(`${API_BASE}/v1/customers/me/fees`, {
          headers: { 'Authorization': `Bearer ${apiKey}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          document.getElementById('fee-monthly-volume').textContent = `$${data.monthlyVolume.toFixed(2)}`;
          document.getElementById('fee-current-rate').textContent = `${data.feePercent}%`;
        }
      } catch (error) {
        console.error('Failed to load fee info:', error);
      }
    }

    async function loadPayoutWallet() {
      try {
        const response = await fetch(`${API_BASE}/v1/customers/me`, {
          headers: { 'Authorization': `Bearer ${apiKey}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.payoutWallet) {
            document.getElementById('payout-wallet').value = data.payoutWallet;
          }
        }
      } catch (error) {
        console.error('Failed to load payout wallet:', error);
      }
    }

    function copyApiKey() {
      navigator.clipboard.writeText(apiKey);
      const btn = document.querySelector('.copy-btn');
      btn.classList.add('copied');
      setTimeout(() => btn.classList.remove('copied'), 2000);
    }

    function toggleApiKeyVisibility() {
      apiKeyVisible = !apiKeyVisible;
      const display = document.getElementById('api-key-display');
      const btn = display.nextElementSibling.nextElementSibling;
      
      if (apiKeyVisible) {
        display.textContent = apiKey;
        display.classList.remove('api-key-hidden');
        btn.textContent = 'Hide';
        document.getElementById('code-api-key').textContent = `'${apiKey}'`;
      } else {
        display.textContent = 'sk_live_â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
        display.classList.add('api-key-hidden');
        btn.textContent = 'Show';
        document.getElementById('code-api-key').textContent = "'sk_live_...'";
      }
    }

    function copyWebhookSecret() {
      // In real app, this would copy the actual webhook secret
      navigator.clipboard.writeText('whsec_' + currentUser.id);
      alert('Webhook secret copied!');
    }

    // Mobile sidebar toggle
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('open');
      document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
    }

    function logout() {
      localStorage.removeItem('asterpay_user');
      localStorage.removeItem('asterpay_api_key');
      window.location.href = 'login.html';
    }

    // Close modal on overlay click
    document.getElementById('create-payment-modal').addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        closeModal();
      }
    });

    document.getElementById('payment-success-modal').addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        closeSuccessModal();
      }
    });
  </script>
</body>
</html>
